<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music App</title>
    <script type="module">
        // Import Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-analytics.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";
        import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAF8R4iNFv3oAZVOZcw5fWUPz8FScTeBXM",
            authDomain: "musicapp-3a435.firebaseapp.com",
            databaseURL: "https://musicapp-3a435-default-rtdb.firebaseio.com",
            projectId: "musicapp-3a435",
            storageBucket: "musicapp-3a435.appspot.com",
            messagingSenderId: "224181252004",
            appId: "1:224181252004:web:4589e9da0d6400e5fd1b31",
            measurementId: "G-FY5VPQG5NZ"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const database = getDatabase(app);
        const provider = new GoogleAuthProvider();

        // Sign in with Google
        function signIn() {
            signInWithPopup(auth, provider)
                .then((result) => {
                    console.log("âœ… Signed in:", result.user.displayName);
                    document.getElementById("user-info").innerText = `Logged in as: ${result.user.displayName}`;
                })
                .catch((error) => {
                    console.error("âŒ Sign-in Error:", error);
                });
        }

        // Sign out
        function signOutUser() {
            signOut(auth)
                .then(() => {
                    console.log("âœ… User signed out");
                    document.getElementById("user-info").innerText = "Not logged in";
                })
                .catch((error) => {
                    console.error("âŒ Sign-out Error:", error);
                });
        }

        // Check authentication state
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("âœ… User is signed in:", user.displayName);
                document.getElementById("user-info").innerText = `Logged in as: ${user.displayName}`;
            } else {
                console.log("ðŸš« No user signed in.");
                document.getElementById("user-info").innerText = "Not logged in";
            }
        });

        // Save song to Firebase Realtime Database
        function saveSong() {
            const songInput = document.getElementById("song-input").value;
            if (songInput.trim() === "") {
                alert("Please enter a song name.");
                return;
            }

            const songsRef = ref(database, "songs/");
            push(songsRef, {
                name: songInput,
                timestamp: Date.now(),
            })
            .then(() => {
                console.log("âœ… Song added:", songInput);
                document.getElementById("song-input").value = "";
                alert("Song saved!");
            })
            .catch((error) => {
                console.error("âŒ Database Error:", error);
            });
        }

        // Listen for changes in the database
        onValue(ref(database, "songs/"), (snapshot) => {
            const songList = document.getElementById("song-list");
            songList.innerHTML = ""; // Clear old list

            if (snapshot.exists()) {
                snapshot.forEach((childSnapshot) => {
                    const song = childSnapshot.val().name;
                    const listItem = document.createElement("li");
                    listItem.textContent = song;
                    songList.appendChild(listItem);
                });
            } else {
                songList.innerHTML = "<li>No songs found.</li>";
            }
        });

        // Make functions available globally
        window.signIn = signIn;
        window.signOutUser = signOutUser;
        window.saveSong = saveSong;
    </script>
</head>
<body>
    <h1>Music App</h1>

    <!-- User Info -->
    <p id="user-info">Not logged in</p>
    
    <!-- Authentication Buttons -->
    <button onclick="signIn()">Sign in with Google</button>
    <button onclick="signOutUser()">Sign Out</button>

    <!-- Song Input -->
    <h2>Add a Song</h2>
    <input type="text" id="song-input" placeholder="Enter song name">
    <button onclick="saveSong()">Save Song</button>

    <!-- Display Song List -->
    <h2>Saved Songs</h2>
    <ul id="song-list"></ul>
</body>
</html>

