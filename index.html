// Firebase configuration (keep your existing configuration here)
const firebaseConfig = {
    apiKey: "AIzaSyAF8R4iNFv3oAZVOZcw5fWUPz8FScTeBXM",
    authDomain: "musicapp-3a435.firebaseapp.com",
    projectId: "musicapp-3a435",
    storageBucket: "musicapp-3a435.appspot.com",
    messagingSenderId: "224181252004",
    appId: "1:224181252004:web:4589e9da0d6400e5fd1b31",
    measurementId: "G-FY5VPQG5NZ"
};
firebase.initializeApp(firebaseConfig);

let player;
let playlist = []; // Store playlist songs
let currentSongIndex = 0; // Track current song in playlist

// Initialize YouTube Player when API is ready
function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
        height: '390',
        width: '640',
        videoId: 'dQw4w9WgXcQ', // Example default video
        events: {
            'onStateChange': onPlayerStateChange
        }
    });
}

// Handle YouTube player state change (e.g., video ended)
function onPlayerStateChange(event) {
    if (event.data == YT.PlayerState.ENDED) {
        nextSong(); // Play next song when current one ends
    }
}

// Play current song
function playSong() {
    if (player) {
        player.playVideo();
        document.getElementById('play-button').style.display = 'none';
        document.getElementById('pause-button').style.display = 'inline';
    }
}

// Pause current song
function pauseSong() {
    if (player) {
        player.pauseVideo();
        document.getElementById('play-button').style.display = 'inline';
        document.getElementById('pause-button').style.display = 'none';
    }
}

// Next song in playlist
function nextSong() {
    if (playlist.length > 0) {
        currentSongIndex = (currentSongIndex + 1) % playlist.length;
        loadSong(playlist[currentSongIndex].id);
    }
}

// Previous song in playlist
function previousSong() {
    if (playlist.length > 0) {
        currentSongIndex = (currentSongIndex - 1 + playlist.length) % playlist.length;
        loadSong(playlist[currentSongIndex].id);
    }
}

// Load song by video ID
function loadSong(videoId) {
    if (player) {
        player.loadVideoById(videoId);
    }
}

// Search YouTube for songs
document.getElementById('search-button').addEventListener('click', function() {
    const query = document.getElementById('search-bar').value;
    if (query) {
        searchYouTube(query);
    }
});

// Use YouTube API to search for videos
function searchYouTube(query) {
    const youtubeSearchUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${query}&type=video&key=YOUR_API_KEY`;
    
    fetch(youtubeSearchUrl)
        .then(response => response.json())
        .then(data => {
            const videos = data.items;
            displayPlaylist(videos);
        })
        .catch(err => console.error('Error fetching YouTube data:', err));
}

// Display playlist of videos
function displayPlaylist(videos) {
    playlist = videos.map(video => ({
        id: video.id.videoId,
        title: video.snippet.title,
        thumbnail: video.snippet.thumbnails.default.url
    }));

    const playlistContainer = document.getElementById('playlist');
    playlistContainer.innerHTML = '';
    playlist.forEach((video, index) => {
        const listItem = document.createElement('li');
        listItem.innerHTML = `<img src="${video.thumbnail}" alt="thumb"><span>${video.title}</span>`;
        listItem.addEventListener('click', () => loadSong(video.id));
        playlistContainer.appendChild(listItem);
    });

    // Load the first song from the playlist
    if (playlist.length > 0) {
        loadSong(playlist[0].id);
    }
}

// Event listeners for play, pause, next, back buttons
document.getElementById('play-button').addEventListener('click', playSong);
document.getElementById('pause-button').addEventListener('click', pauseSong);
document.getElementById('next-button').addEventListener('click', nextSong);
document.getElementById('back-button').addEventListener('click', previousSong);
