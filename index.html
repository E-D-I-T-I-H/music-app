<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Music Player</title>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- TOP CONTAINER -->
    <div id="top-container">
        <!-- LEFT: YouTube Player + Controls -->
        <div id="left-container">
            <div id="player"></div>
            <div id="controls-container">
                <div id="seek-bar-container">
                    <button id="prev-btn">‚èÆÔ∏è</button>
                    <input type="range" id="seek-bar" value="0">
                    <button id="next-btn">‚è≠Ô∏è</button>
                </div>
                <div id="play-pause-container">
                    <button id="play-pause-btn">‚èØÔ∏è</button>
                </div>
            </div>
        </div>

        <!-- RIGHT: Search Bar + Search Results -->
        <div id="search-container">
            <input type="text" id="search-input" placeholder="Search YouTube">
            <button id="search-button">üîç</button>
            <button id="add-to-playlist">‚ûï</button>
            <ul id="search-results"></ul>
        </div>

        <!-- AUTH: Sign-In / Sign-Out -->
        <div id="auth-container">
            <button id="login-btn">Sign In</button>
            <button id="logout-btn" style="display:none;">Sign Out</button>
        </div>
    </div>

    <!-- PLAYLIST (Visible to Everyone) -->
    <div id="playlist-container">
        <h3>Playlist</h3>
        <ul id="playlist"></ul>
    </div>

    <script>
        // Your YouTube API Key
        const YOUTUBE_API_KEY = "AIzaSyBFfY5CZScu8FdE2oLjaCTQ3H5WbAQXos8";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "YOUR_FIREBASE_CONFIG",
            authDomain: "YOUR_FIREBASE_CONFIG",
            databaseURL: "YOUR_FIREBASE_CONFIG",
            projectId: "YOUR_FIREBASE_CONFIG",
            storageBucket: "YOUR_FIREBASE_CONFIG",
            messagingSenderId: "YOUR_FIREBASE_CONFIG",
            appId: "YOUR_FIREBASE_CONFIG"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let player, currentVideoId = "", playlist = [], currentIndex = 0;

        // YouTube Player Setup
        function onYouTubeIframeAPIReady() {
            player = new YT.Player("player", {
                height: "225",
                width: "400",
                events: {
                    "onStateChange": updateSeekBar
                }
            });
        }

        // Search YouTube
        document.getElementById("search-button").addEventListener("click", () => {
            let query = document.getElementById("search-input").value;
            fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${query}&type=video&key=${YOUTUBE_API_KEY}`)
                .then(response => response.json())
                .then(data => {
                    let resultsContainer = document.getElementById("search-results");
                    resultsContainer.innerHTML = "";
                    data.items.forEach(video => {
                        let li = document.createElement("li");
                        li.textContent = video.snippet.title;
                        li.style.cursor = "pointer";
                        li.onclick = () => {
                            currentVideoId = video.id.videoId;
                            player.loadVideoById(currentVideoId);
                            resultsContainer.innerHTML = ""; // Clear results after selection
                        };
                        resultsContainer.appendChild(li);
                    });
                });
        });

        // Play/Pause Button
        document.getElementById("play-pause-btn").addEventListener("click", () => {
            let state = player.getPlayerState();
            if (state === 1) player.pauseVideo();
            else player.playVideo();
        });

        // Seek Bar
        function updateSeekBar() {
            setInterval(() => {
                if (player && player.getDuration) {
                    document.getElementById("seek-bar").value = (player.getCurrentTime() / player.getDuration()) * 100;
                }
            }, 1000);
        }
        document.getElementById("seek-bar").addEventListener("input", (e) => {
            let seekTo = (e.target.value / 100) * player.getDuration();
            player.seekTo(seekTo, true);
        });

        // Prev & Next Buttons
        document.getElementById("prev-btn").addEventListener("click", () => {
            if (currentIndex > 0) {
                currentIndex--;
                player.loadVideoById(playlist[currentIndex]);
            }
        });
        document.getElementById("next-btn").addEventListener("click", () => {
            if (currentIndex < playlist.length - 1) {
                currentIndex++;
                player.loadVideoById(playlist[currentIndex]);
            }
        });

        // Google Authentication
        function updateUI(user) {
            if (user) {
                document.getElementById("login-btn").style.display = "none";
                document.getElementById("logout-btn").style.display = "block";
            } else {
                document.getElementById("login-btn").style.display = "block";
                document.getElementById("logout-btn").style.display = "none";
            }
        }
        firebase.auth().onAuthStateChanged(updateUI);
        document.getElementById("login-btn").addEventListener("click", () => {
            firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider());
        });
        document.getElementById("logout-btn").addEventListener("click", () => {
            firebase.auth().signOut();
        });

        // Add to Playlist & Store in Firebase
        document.getElementById("add-to-playlist").addEventListener("click", () => {
            if (currentVideoId) {
                db.ref("playlist").push(currentVideoId);
            }
        });

        // Load Playlist from Firebase
        db.ref("playlist").on("value", (snapshot) => {
            let list = document.getElementById("playlist");
            list.innerHTML = "";
            playlist = [];
            snapshot.forEach(child => {
                let li = document.createElement("li");
                li.textContent = child.val();
                li.style.cursor = "pointer";
                li.onclick = () => {
                    currentIndex = playlist.indexOf(child.val());
                    player.loadVideoById(child.val());
                };
                list.appendChild(li);
                playlist.push(child.val());
            });
        });
    </script>
</body>
</html>
